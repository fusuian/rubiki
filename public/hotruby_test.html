<?xml version="1.0" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
	    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>HotRuby Unit Test</title>
		<script language="JavaScript" type="text/javascript" src="/jsUnit/jsUnitCore.js"></script>
		<script type="text/javascript" src="/js/jquery-1.4.4.min.js"></script>
		<script type="text/javascript" src="/js/HotRuby.js"></script>
		<script language="JavaScript" type="text/javascript">
		// rubyuri = "http://localhost:7070";
		rubyuri = "http://192.168.2.111:7070";
		
		function compileAndRun(test, src) {
			hotruby = new HotRuby();
			hotruby.compileAndRun(rubyuri + "/compile_ruby/" + escape(test), src, false);
		}
		
		function setUp(){
  			this.debug = $("#debug");
    	}
		
    	function tearDown() {
			this.debug.empty();
    	}
				
		// テストコードを記述
		function testHelloWorld() {
			compileAndRun("testHelloWorld", "puts %Q(Hello, World!)");
  			assertEquals('Hello, World!', $("#debug").text());
		}

		function testArguments() {
			var src = $("#arguments").text(); 
			compileAndRun("test", src);
  			assertEquals('10, 200', $("#debug").text());
		}
		
		function testMethodArguments() {
			var src = $("#method_arguments").text(); 
			compileAndRun("test", src);
  			assertEquals('10, 200', $("#debug").text());
		}
		
		function testMultipleAssignment() {
			var src = $("#multiple_assignment").text(); 
			compileAndRun("test", src);
  			assertEquals('1,2|1,2,3|1,2,3,4', $("#debug").text());
		}

		function testClassVar() {
			var src = $("#classvar").text(); 
			compileAndRun("test", src);
			var divs = $("#debug > div")
			assertEquals(2, divs.length);
  			assertEquals('foobar', divs.text());
		}
		
		function testHashSymbol(){
			var src = $("#hash_symbol").text();
			compileAndRun("test", src);
			assertEquals("truenilOK", $("#debug").text());
		}
		
		function testTimeTime(){
			var src = $("#timetime").text();
			compileAndRun("test", src);
			assertEquals("0, 0|1, 0|2, 0|0, 1|1, 1|2, 1|0, 2|1, 2|2, 2|", $("#debug").text());
		}

		function testUptoStep(){
			var src = $("#upto_step").text();
			compileAndRun("test", src);
			assertEquals("10,20|10,21|10,22|11,20|11,21|11,22|12,20|12,21|12,22|", $("#debug").text());
		}

		function testSprintf(){
			var src = $("#sprintf").text();
			compileAndRun("test", src);
			assertEquals("%4d|117| 117|0117|0075|#75|[%string]|", $("#debug").text());
		}

//		pending		
//		function testDefaultArg() {
//			var src = $("#default_arg").text();
//			compileAndRun("test", src);
//			assertEquals("2|2|", $("#debug").text());
//		}
				
		function testPow() {
			var src = $("#pow").text();
			compileAndRun("test", src);
			assertEquals("4|27|125|1|", $("#debug").text());
		}

		</script>
	</head>
	<body>
		<div id="content">
			<canvas id="canvas" width="432" height="240" style="border: 3px double black;"></canvas>
			<div>Result:</div>
			<div id="debug" class="result"></div>
			<pre id="opcode"></pre>
		</div>
		<textarea id = "arguments">
			class Hoge
				attr_reader :a
				attr_reader :b
				def initialize(a, b)
		 			@a, @b = a, b
				end
			end
			hoge = Hoge.new(10, 200)
			puts "#{hoge.a}, #{hoge.b}"
		</textarea>
		
		<textarea id = "method_arguments">
			def hoge(a, b)
				 c, d = a, b
				 puts "#{c}, #{d}"
			end
			hoge 10, 200
		</textarea>
		
		<textarea id="multiple_assignment">
			a, b = 1, 2
			puts "#{a},#{b}|"
			a, b, c = 1, 2, 3
			puts "#{a},#{b},#{c}|"
			a, b, c, d = 1, 2, 3, 4
			puts "#{a},#{b},#{c},#{d}"
		</textarea>
		
		<textarea id="classvar">
			class Foo
  				@@foo = :foo
  
  				def foo
    				@@foo
  				end
  
  				def foo=(var)
    				@@foo=var
  				end
			end

			f1 = Foo.new
			puts f1.foo
			f1.foo = :bar
			f2 = Foo.new
			puts f2.foo
		</textarea>
		
		<textarea id="hash_symbol">
			$foo = {}
			$foo[:bar] = true
			puts $foo[:bar]
			puts $foo[:foo]
			if $foo[:bar]
  				puts "OK"
			else
  				puts "NG"
			end
		</textarea>
		
		<textarea id="timetime">
			3.times do |y|
  				3.times do |x|
    				puts "#{x}, #{y}|"
  				end
			end
		</textarea>
		
		<textarea id="sprintf">
			puts "%4d|"
			puts sprintf("%d|", 117.14) # 117
			puts sprintf("%4d|", 117.14) # 117
			puts sprintf("%04d|", 117.14) # 0117
			puts sprintf("%04x|", 117.14) # 0075
			puts sprintf("#%02x|", 117.14) # #75
			puts sprintf("[%%%s]|", "string") # [%string]
		</textarea>
		
		<textarea id="upto_step">
			10.upto(12) do |x|
  				20.step(22) do |y|
     				puts "#{x},#{y}|"
  				end
			end
		</textarea>
		
		<textarea id="default_arg">
			def hoge(a = 0)
				a*2
			end
			puts "#{hoge(2)}|" 
			#puts "#{hoge}|" 
		</textarea>
		
		<textarea id="pow">
			puts "#{2**2}|"
			puts "#{3**3}|"
			puts "#{5**3}|"
			puts "#{1**0}|"
		</textarea>
	</body>
</html>
